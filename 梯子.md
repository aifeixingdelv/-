## Ubuntu 20.04 梯子软件
v2ray-core [v4.23.2](https://github.com/v2fly/v2ray-core/releases/download/v4.23.2/v2ray-linux-64.zip)  
Qv2ray [v2.6](https://github.com/Qv2ray/Qv2ray/releases/download/v2.6.0/Qv2ray.v2.6.0.linux-x64.AppImage)
Ubuntu下的代理配置 - Torch-Fanvar Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"www.torch-fan.site",root:"/",version:"1.9.0",typing:{enable:!0,typeSpeed:70,cursorChar:"\_",loop:!1,scope:\[\]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height\_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code\_language:{enable:!0,default:"TEXT"},copy\_btn:!0,image\_caption:{enable:!0},image\_zoom:{enable:!0,img\_url\_replace:\["",""\]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading\_img:"/img/loading.gif",onlypost:!1,offset\_factor:2},web\_analytics:{enable:!1,follow\_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app\_id:null,app\_key:null,server\_url:null,path:"window.location.pathname",ignore\_local:!1}},search\_path:"/local-search.xml"};CONFIG.web\_analytics.follow\_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))

[**Torch-Fan**](/)

*     [](javascript:;)
*   [首页](/)
*   [归档](/archives/)
*   [分类](/categories/)
*   [标签](/tags/)
*   [关于](/about/)
*     [](javascript:;)

2022年7月20日 晚上

4.1k 字 35 分钟

Ubuntu下的代理配置
============

[](#1-软件选择)1\. 软件选择：
====================

> 在2022年，clash已经成为了主流的VPN工具，因此这篇笔记也主要推荐clash的软件，至于随着技术变革，也只有软件的变化，其余操作仍然维持不变的～

说到clash，在Linux下，`Clash for windows`就是一个最好用的软件，这个软件支持mac os，windows和Liinux。（尽管他的名字带有`for windows`，或许这个软件最初只是为windows准备的）

[](#2-代理配置)2\. 代理配置：
====================

Ubuntu系统配置代理，按照如下进行操作：`设置 -> 网络 -> 网络代理（齿轮图标）-> 手动`

随后，在`HTTP代理`和`HTTPS代理`上填写IP: `127.0.0.1`和port: `7890`

> 这里IP`127.0.0.1`即可，至于端口，要看软件中选择监听的端口号。clash相关软件一般是`7890`

> ! 注意：不推荐在Ubuntu下使用socket代理，因为截至2022年，越来越多的网站开始使用websocket进行数据交互，根据实际体验，开启socket代理会导致此类网站连接异常（出现connection error的情况），比如grammarly的word插件就无法正常运行。  
> 不过socket代理只有`mac`和`linux`才需要考虑，windows并不存在（或者说我没有感知到）。

[](#21-配置命令行代理)2.1 配置命令行代理：
---------------------------

1  
2  
3  
4  

    # HTTP_PROXY 和 http_proxy 都行export http_proxy=127.0.0.1:7890export https_proxy=127.0.0.1:7890export no_proxy="localhost,127.0.0.1,10.96.0.0/12,192.168.0.1/16,192.168.49.2"

当然更完整的是这个：

1  
2  
3  
4  
5  
6  
7  

    export proxy_ip=10.11.57.211export http_proxy=http://$proxy_ip:7890export https_proxy=http://$proxy_ip:7890export HTTP_PROXY=http://$proxy_ip:7890export HTTPS_PROXY=http://$proxy_ip:7890export no_proxy=localhost,127.0.0.1,10.96.0.0/12,192.168.0.1/16,192.168.49.2export NO_PROXY=localhost,127.0.0.1,10.96.0.0/12,192.168.0.1/16,192.168.49.2

> 在命令行输入如下命令后，一般命令行中大部分程序会遵循此代理，然而事无绝对，因此后面会给出部分程序的代理设置方式。
> 
> 在ubuntu较早版本，我记得git的代理是不经过`http_proxy`的, 需要这样设置
> 
> 1  
> 2  
> 
>     git config --global http.proxy http://127.0.0.1:7890git config --global https.proxy https://127.0.0.1:7890
> 
> 但是在使用Ubuntu20.04和Ubuntu22.04时, 发现git会使用`http_proxy`中的代理了, 因此git就不单独讲了

> Docker的代理则更为复杂, 因为在Dockerfile构建过程中, 环境变量会被构建出的容器自身覆盖(或者说本不存在覆盖,只是自立更生罢了), 而且容器与Host之间的网络映射和端口问题又蒙上一层纱, 因此Docker的代理设置会单独列出一节, 不过等日后我再次遇到这种场景时再仔细总结一下.

[](#22-apt-get代理设置)2.2 apt-get代理设置
----------------------------------

有两种可选的方式:

1.  `sudo vim /etc/apt/apt.conf`
2.  在`/etc/apt/apt.conf.d/`下创建一个单独的配置文件(推测该目录应该是APT的配置导入目录), 然后添加内容

1  
2  
3  

    Acquire::http::Proxy "http://yourproxyaddress:proxyport";# 如果你的代理需要登陆, 那么将url改为:# "http://username:password@yourproxyaddress:proxyport";

[](#23-socks代理配置)2.3 socks代理配置
------------------------------

对于某些应用程序是无法使用HTTP代理的，这时候，需要设置socket代理, Linux命令行并没有直接设置的方法，需要在系统设置里设置，如果用的软件是cfw，则设置为`127.0.0.1:7890`．但不是很推荐设置系统里的socks代理，只设置终端就够了．

1  
2  

    # terminalexport all_proxy=socks5://127.0.0.1:7890

[](#24-git-ssh端口代理)2.4 git ssh端口代理
----------------------------------

> 这里还列出git的原因是, 有时候, 并不通过htps拉取和上传代码, 设置的是SSH端口的仓库链接, 这时候代理就完全没用了, 需要额外设置.

编辑`~/.ssh/config`, 然后基本应该没得问题了~ 就再不会因为连接超时报错：`kex_exchange_identification: Connection closed by remote host fatal: Could not read from remote repository.`

1  
2  
3  

    Host github.com    ProxyCommand          nc -X connect -x 127.0.0.1:7890 %h %p    ServerAliveInterval   10

> 用Windows的同学就发现了，模仿上面的内容是没用的，上面只是为Linux和Mac os准备，windows用户需要这样设置：
> 
> 注意： GIT\_PATH和username请务必替换为自己的，不要把方框和变量名也照抄了

*   安装好git，并记录好git的安装目录: 用变量`GIT_PATH`指代
*   找到ssh的配置文件: `c:\Users\[username]\.ssh\config`

1  
2  
3  

    Host github.com    ProxyCommand          "[GIT_PATH]\mingw64\bin\connect.exe" -S 127.0.0.1:7890 %h %p    ServerAliveInterval   10

[](#25-docker代理配置)2.5 Docker代理配置：
---------------------------------

> Docker在默认情况下不会继承环境变量中的http\_proxy和https\_proxy, 需要再额外设置：[https://docs.docker.com/network/proxy/](https://docs.docker.com/network/proxy/)
> 
> 由于Docker创建的是虚拟机，因此代理配置应该使用LAN下的ip！

### [](#251-修改配置文件方式-~dockerconfigjson)2.5.1 修改配置文件方式： `~/.docker/config.json`

> 每当创建容器时，都会从配置文件读取代理配置：(代理服务器别忘了换成自己的)

1  
2  
3  
4  
5  
6  
7  
8  
9  
10  
11  

    { "proxies": {   "default":   {     "httpProxy": "http://192.168.8.2:7890",     "httpsProxy": "http://192.168.8.2:7890",     "noProxy": "localhost,127.0.0.1/8,127.0.0.1,10.96.0.0/12,192.168.99.0/24,192.168.39.0/24,192.168.49.2,github.com"   } }}

对于k8s，官方有对应的proxy设置指南：[https://minikube.sigs.k8s.io/docs/handbook/vpn\_and\_proxy/](https://minikube.sigs.k8s.io/docs/handbook/vpn_and_proxy/)

1  

    set NO_PROXY=localhost,127.0.0.1,10.96.0.0/12,192.168.59.0/24,192.168.49.0/24,192.168.39.0/24

1  
2  

    # 事实上，minikube支持根据国家自动设置镜像minikube start --image-mirror-country=cn

### [](#252-参数指定的方式)2.5.2 参数指定的方式：

Variable

Dockerfile example

`docker run` example

`HTTP_PROXY`

`ENV HTTP_PROXY="http://192.168.1.12:3128"`

`--env HTTP_PROXY="http://192.168.1.12:3128"`

`HTTPS_PROXY`

`ENV HTTPS_PROXY="https://192.168.1.12:3128"`

`--env HTTPS_PROXY="https://192.168.1.12:3128"`

`FTP_PROXY`

`ENV FTP_PROXY="ftp://192.168.1.12:3128"`

`--env FTP_PROXY="ftp://192.168.1.12:3128"`

`NO_PROXY`

`ENV NO_PROXY="*.test.example.com,.example2.com"`

`--env NO_PROXY="*.test.example.com,.example2.com"`

### [](#253-在使用minukube的情况下)2.5.3 在使用minukube的情况下：

1  

    minikube start --docker-env http_proxy=http://127.0.0.1:7890 --docker-env https_proxy=http://127.0.0.1:7890 --docker-env no_proxy=localhost,127.0.0.1,10.96.0.0/12,192.168.0.1/16

> 由于no\_proxy很难涵盖所有服务，导致出现莫名奇妙的问题，因此推荐用registry

1  

    minikube start --image-mirror-country=cn --registry-mirror https://dockerhub.azk8s.cn

* * *

[计算机基础](/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/) \> [操作系统](/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/) \> [Linux](/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/) \> [Ubuntu](/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Ubuntu/)

Ubuntu下的代理配置

https://www.torch-fan.site/2022/07/20/Ubuntu下的代理配置/

作者

Torch-Fan

发布于

2022年7月20日

更新于

2023年2月19日

许可协议

[](https://creativecommons.org/licenses/by/4.0/)

[Rust注释 上一篇](/2022/07/21/Rust%E6%B3%A8%E9%87%8A/ "Rust注释")

[Attributes 下一篇](/2022/07/20/Attribute/ "Attributes")

Fluid.utils.loadComments("#comments",function(){var t="github-light",e="github-dark",i="dark"===document.documentElement.getAttribute("data-user-color-scheme")?e:t,t=(window.UtterancesThemeLight=t,window.UtterancesThemeDark=e,document.createElement("script"));t.setAttribute("src","https://utteranc.es/client.js"),t.setAttribute("repo","QiliangFan/qiliangfan.github.io"),t.setAttribute("issue-term","title"),t.setAttribute("label","BlogComment"),t.setAttribute("theme",i),t.setAttribute("crossorigin","anonymous"),document.getElementById("comments").appendChild(t)})

Please enable JavaScript to view the comments

 目录

[](#)

#### 搜索

×

 关键词

[Hexo](https://hexo.io) [Fluid](https://github.com/fluid-dev/hexo-theme-fluid)

NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})!function(t){var e=Fluid.plugins.typing,t=t.getElementById("subtitle");t&&e&&e(t.getAttribute("data-typed-text"))}((window,document))Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init({tocSelector:"#toc-body",contentSelector:".markdown-body",headingSelector:CONFIG.toc.headingSelector||"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:-t}),0<o.find(".toc-list-item").length)&&o.css("visibility","visible")})!function(){var n,i=CONFIG.code\_language.enable&&CONFIG.code\_language.default,t=CONFIG.copy\_btn;(i||t)&&(n="",n=(n+='<div class="code-widget">')+"LANG"+"</div>",jQuery(".markdown-body pre").each(function(){var e,a=jQuery(this);0<a.find("code.mermaid").length||0<a.find("span.line").length||(e="",i&&(e=CONFIG.code\_language.default,0<a\[0\].children.length&&2<=a\[0\].children\[0\].classList.length&&a.children().hasClass("hljs")?e=a\[0\].children\[0\].classList\[1\]:a\[0\].getAttribute("data-language")?e=a\[0\].getAttribute("data-language"):a.parent().hasClass("sourceCode")&&0<a\[0\].children.length&&2<=a\[0\].children\[0\].classList.length?(e=a\[0\].children\[0\].classList\[1\],a.parent().addClass("code-wrapper")):a.parent().hasClass("markdown-body")&&0===a\[0\].classList.length&&a.wrap('<div class="code-wrapper"></div>'),e=e.toUpperCase().replace("NONE",CONFIG.code\_language.default)),a.append(n.replace("LANG",e).replace('code-widget">',(e=a\[0\],(0<=Fluid.utils.getBackgroundLightness(e)?"code-widget-light":"code-widget-dark")+(t?' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>':' code-widget">')))),t&&Fluid.utils.createScript("https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js",function(){new window.ClipboardJS(".copy-btn",{target:function(e){for(var a=e.parentNode.childNodes,n=0;n<a.length;n++)if("CODE"===a\[n\].tagName)return a\[n\]}}).on("success",function(e){e.clearSelection(),e.trigger.innerHTML=e.trigger.innerHTML.replace("icon-copy","icon-success"),setTimeout(function(){e.trigger.innerHTML=e.trigger.innerHTML.replace("icon-success","icon-copy")},2e3)})}))}))}()Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var o,n=\[\];for(o of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))n.push(".markdown-body > "+o.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(n.join(", "))})Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})Fluid.plugins.imageCaption()

博客在允许 JavaScript 运行的环境下浏览效果更佳
